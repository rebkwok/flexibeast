{% extends "base.html" %}
{% load staticfiles %}
{% load reviewtags %}

{% block extra_head %}<link rel="stylesheet" href="{% static 'reviews/css/reviews.css' %}">{% endblock %}

{% block content %}

<div class="row container">
    <div class="page-header col-sm-12">
        <h1>
            Testimonials
        </h1>

        {% if user.is_staff %}
            <p><a href="{% url 'reviews:staff_reviews' %}">Review and approve submitted testimonials</a></p>
        {% endif %}

    </div>

    {% if reviews %}
        {% for review in reviews %}
            <div class="col-sm-12"><h4>
                {% if not review.edited or review.update_published %}
                        {{ review.title }}
                {% else %}
                    {{ review.previous_title }}
                {% endif %}
            </h4></div>
            <div class="col-sm-2">
                <p>{% if not review.edited %}
                        {% show_rating review.rating %}<br>
                        {{ review.submission_date|date:'d M Y' }}<br>
                    {% else %}
                        {% if review.update_published %}
                            {% show_rating review.rating %}<br>
                            {{ review.edited_date|date:'d M Y' }}<br>
                        {% else %}
                            {% show_rating review.previous_rating %}<br>
                            {{ review.submission_date|date:'d M Y' }}<br>
                        {% endif %}
                    {% endif %}
                <span class="fa fa-user"></span> {{ review.user_display_name }}
                </p></div>
            <div class="col-sm-10 review">
                {% if not review.edited or review.update_published %}
                    <span class="fa fa-quote-left fa-lg fa-pull-left fa-border"></span>{{ review.review }}
                {% else %}
                    <span class="fa fa-quote-left fa-lg fa-pull-left fa-border"></span>{{ review.previous_review }}
                {% endif %}
            </div>
            {% if review in user_reviews %}
                    <div class="col-sm-12">
                <a href="{% url 'reviews:edit_review' review.slug %}"><div class="pull-right btn btn-warning reviews-btn">Edit</div></a>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <div class="col-sm-12">No testimonials available to view.</div>
    {% endif %}

    <div class="col-sm-12">
        <br>
        {% if user.is_authenticated %}
            <a href="{% url 'reviews:add_review' %}"><div class="btn btn-success reviews-btn">Add a testimonial</div></a>
        {% else %}
            <a class="btn btn-success reviews-btn" href="{% url 'account_login' %}?next={{request.get_full_path}}">Sign in</a> to add a testimonial
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_scripts %}{% endblock %}